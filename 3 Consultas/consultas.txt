-- GROUP BY/HAVING
-- Seleciona o nome dos hospitais cujo número de pacientes atendidos é maior que 1
SELECT H.NOME, COUNT(*) 
    FROM HOSPITAL H 
    INNER JOIN ATENDE A 
    ON H.CNPJ = A.CNPJ 
    GROUP BY H.NOME, A.CNPJ 
    HAVING COUNT(*) > 1



-- JUNÇÃO INTERNA
-- Seleciona o nome dos funcionários que são médicos
SELECT DISTINCT F.NOME 
	FROM FUNCIONARIO F 
    INNER JOIN MEDICO M 
    ON F.CPF = M.CPF_MEDICO




-- JUNÇÃO EXTERNA
-- Seleciona os hospitais e os números de suas salas
SELECT H.NOME, S.NUMERO
FROM HOSPITAL H 
    LEFT OUTER JOIN SALA S 
    ON H.CNPJ = S.CNPJ



-- SEMIJOIN
-- Seleciona salas onde houve prescrição de medicamentos
SELECT S.ID_SALA 
	FROM SALA S 
    WHERE EXISTS
    ( 
		SELECT P.ID_SALA 
        FROM PRESCRICAO P 
        WHERE S.ID_SALA = P.ID_SALA 
	)



-- ANTIJOIN
-- Seleciona salas onde não houve a prescrição de medicamentos
SELECT S.ID_SALA 
	FROM SALA S 
    WHERE NOT EXISTS
    ( 
		SELECT P.ID_SALA 
        FROM PRESCRICAO P 
        WHERE S.ID_SALA = P.ID_SALA 
	)



-- SUBCONSULTA ESCALAR
-- Seleciona funcionários com o salário maior do que a média de todos os funcionários

SELECT NOME, CPF, SALARIO
FROM FUNCIONARIO
WHERE SALARIO > (
    SELECT AVG(SALARIO)
    FROM FUNCIONARIO
)



-- SUBCONSULTA LINHA
-- Seleciona a prescrição que tem o medicamento Omeprazol

SELECT p.ID_PRESCRICAO, p.DOSAGEM, p.DESCRICAO, p.ID_MEDICAMENTO, p.ID_SALA, p.CPF_M, p.CPF_P, p.HORACONSULTA
FROM PRESCRICAO p
JOIN MEDICAMENTO m ON p.ID_MEDICAMENTO = m.ID_MEDICAMENTO
WHERE m.NOME = 'Omeprazol';



-- SUBCONSULTA TIPO TABELA
-- Seleciona prescrições cujas consultas tem no nome 'rotina'

SELECT ID_PRESCRICAO 
	FROM PRESCRICAO P 
    WHERE (P.ID_SALA, P.HORACONSULTA) IN  
    ( 
		SELECT C.ID_SALA, C.HORACONSULTA
			FROM CONSULTA C 
            WHERE C.DESCRICAO LIKE '%rotina' 
	);




-- OPERAÇÃO DE CONJUNTO
-- Seleciona o nome de todos os funcionários que não são médicos
SELECT F.NOME 
	FROM MEDICO M 
    RIGHT JOIN FUNCIONARIO F 
    ON F.CPF = M.CPF_MEDICO 
	
MINUS  

SELECT F.NOME 
    FROM FUNCIONARIO F 
    RIGHT JOIN MEDICO M 
    ON F.CPF = M.CPF_MEDICO